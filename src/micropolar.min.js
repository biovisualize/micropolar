micropolar={version:"0.1.0"},micropolar.Axis=function(){function a(){var a=e.containerSelector;"string"==typeof a&&(a=d3.select(a)),a.datum(e.data).each(function(a){function i(){var a=d3.mouse(m.node()),r=a[0]-e.width/2,t=a[1]-e.height/2,i=180*((Math.atan2(t,r)+Math.PI)/Math.PI),n=Math.sqrt(r*r+t*t);return{angle:i,radius:n}}"object"!=typeof e.geometry&&(e.geometry=[e.geometry]),"object"!=typeof a[0][0]&&(a=[a]);var n=Math.min(e.width,e.height)/2-e.margin,l=d3.extent(a[0].map(function(a){return a[1]}));r=d3.scale.linear().domain(e.radialDomain||l).range([0,n]);var o=d3.extent(a[0].map(function(a){return a[0]})),c=e.angularDomain||o,s="string"==typeof c[0];s?c=[0,c.length*(e.minorTicks+1)]:(c[2]||(c[2]=e.angularTicksStep),c[2]/=e.minorTicks+1),e.additionalAngularEndTick&&(c[1]+=1);var d=d3.range.apply(this,c);s||(d=d.map(function(a){return parseFloat(a.toPrecision(12))})),t=d3.scale.linear().domain(c.slice(0,2)).range(e.flip?[0,360]:[360,0]);var u='<svg class="chart-root">                         <g class="chart-group">                             <circle class="background-circle"></circle>                             <g class="angular axis-group"></g>                            <g class="geometry-group"></g>                            <g class="radial axis-group">                                 <circle class="outside-circle"></circle>                             </g>                             <g class="guides-group"><line></line><circle></circle></g>                         </g>                     </svg>',g={fill:"none",stroke:"silver"},f={"font-size":11,"font-family":"Tahoma, sans-serif"},h=d3.select(this).selectAll("div.chart-container").data([0]);h.enter().append("div").classed("chart-container",!0).html(u);var m=h.select("svg");m.attr({width:e.width,height:e.height}).style({"pointer-events":"none"});var p=m.select(".chart-group").attr("transform","translate("+e.width/2+","+e.height/2+")"),k=m.select(".radial.axis-group");if(e.showRadialCircle){var v=k.selectAll("circle.grid-circle").data(r.ticks(5));v.enter().append("circle").attr({"class":"grid-circle"}).style(g),v.attr("r",r),v.exit().remove()}k.select("circle.outside-circle").attr({r:n}).style(g),m.select("circle.background-circle").attr({r:n}).style(g);var y=function(a,r){return(t(s?r:a)+e.originTheta)%360};if(e.showRadialAxis){var S=d3.svg.axis().scale(r).ticks(5).tickSize(5),k=m.select(".radial.axis-group").call(S).attr({transform:"rotate("+e.radialAxisTheta+")"});k.selectAll(".domain").style(g),k.selectAll("g>text").text(function(){return this.textContent+e.radialTicksSuffix}).style(f).style({"text-anchor":"start"}).attr({x:0,y:0,dx:0,dy:0,transform:function(){return"horizontal"===e.radialTickOrientation?"rotate("+-e.radialAxisTheta+") translate("+[0,f["font-size"]]+")":"translate("+[0,f["font-size"]]+")"}}),k.selectAll("g>line").style({stroke:"black"})}var x=m.select(".angular.axis-group").selectAll("g.angular-tick").data(d),T=x.enter().append("g").attr({"class":"angular-tick",transform:function(a,r){return"rotate("+y(a,r)+")"}});x.exit().remove(),T.append("line").attr({"class":"grid-line"}).classed("major",function(a,r){return 0==r%(e.minorTicks+1)}).classed("minor",function(a,r){return!(0==r%(e.minorTicks+1))}).style(g),T.selectAll(".minor").style({stroke:"#eee"}),T.append("text").attr({"class":"axis-text"}).style(f),m.selectAll("line.grid-line").attr({x1:e.tickLength?n-e.tickLength:0,x2:n});var A=m.selectAll("text.axis-text").attr({x:n+e.labelOffset,dy:".35em",transform:function(a,r){var t=y(a,r),i=n+e.labelOffset,l=e.angularTickOrientation;return"horizontal"==l?"rotate("+-t+" "+i+" 0)":"radial"==l?270>t&&t>90?"rotate(180 "+i+" 0)":null:"rotate("+(180>=t&&t>0?-90:90)+" "+i+" 0)"}}).style({"text-anchor":"middle"}).text(function(a,r){return s?0==r%(e.minorTicks+1)?e.angularDomain[r/(e.minorTicks+1)]+e.angularTicksSuffix:"":0==r%(e.minorTicks+1)?a+e.angularTicksSuffix:""}).style(f);e.rewriteTicks&&A.text(function(a,r){return e.rewriteTicks(this.textContent,r)});var b=this;e.geometry.forEach(function(i,n){var l="geometry"+n,o=d3.select(b).select("svg g.geometry-group").selectAll("g."+l).data([0]).enter().append("g").classed(l,!0);i.config({data:a[n],axisConfig:e,radialScale:r,angularScale:t,containerSelector:o})()}),m.select(".geometry-group g").style({"pointer-events":"visible"});var w=m.select(".guides-group");p.on("mousemove.angular-guide",function(){var a=i().angle;w.select("line").attr({x1:0,y1:0,x2:-n,y2:0,transform:"rotate("+a+")"}).style({stroke:"grey",opacity:1})}).on("mouseout.angular-guide",function(){w.select("line").style({opacity:0})}),p.on("mousemove.radial-guide",function(){var a=i().radius;w.select("circle").attr({r:a}).style({stroke:"grey",fill:"none",opacity:1})}).on("mouseout.radial-guide",function(){w.select("circle").style({opacity:0})})})}var r,t,e={geometry:[],data:[],height:500,width:500,radialDomain:null,angularDomain:null,angularTicksStep:1,flip:!0,originTheta:0,labelOffset:10,radialAxisTheta:-45,radialTicksSuffix:"",angularTicksSuffix:"",hideFirstTick:!0,angularTicks:null,showRadialAxis:!0,showRadialCircle:!0,minorTicks:0,tickLength:null,rewriteTicks:null,angularTickOrientation:"horizontal",radialTickOrientation:"horizontal",containerSelector:"body",margin:25,additionalAngularEndTick:!0},i=d3.dispatch("hover");return a.config=function(a){return arguments.length?(micropolar._override(a,e),this):e},a.radialScale=function(){return r},a.angularScale=function(){return t},d3.rebind(a,i,"on"),a},micropolar._override=function(a,r){for(var t in a)t in r&&(r[t]=a[t])},micropolar._rndSnd=function(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)},micropolar.BarChart=function(){function a(){var a=r.containerSelector;"string"==typeof a&&(a=d3.select(a)),a.datum(r.data).each(function(a){var t={fill:r.fill,stroke:r.stroke},e=12,i=d3.select(this).classed("bar-chart",!0),n=i.selectAll("rect.mark").data(a);n.enter().append("rect").attr({"class":"mark"}),n.attr({x:-e/2,y:r.radialScale(0),width:e,height:function(a){return r.radialScale(a[1])-r.radialScale(0)},transform:function(a){return"rotate("+(r.axisConfig.originTheta-90+r.angularScale(a[0]))+")"}}).style(t)})}var r={data:null,containerSelector:"body",dotRadius:5,fill:"orange",stroke:"red",radialScale:null,angularScale:null,axisConfig:null},t=d3.dispatch("hover");return a.config=function(a){return arguments.length?(micropolar._override(a,r),this):r},d3.rebind(a,t,"on"),a},micropolar.Clock=function(){function a(){var a=r.containerSelector;"string"==typeof a&&(a=d3.select(a)),a.datum(r.data).each(function(a){var t=r.radialScale.range()[1],e=[t/1.3,t/1.5,t/1.5],i=[t/15,t/10,t/30];a=[0,4,8],r.angularScale.domain([0,12]);var n={fill:r.fill,stroke:r.stroke},l=d3.select(this).classed("clock",!0),o=l.selectAll("rect.mark").data(a);o.enter().append("rect").attr({"class":"mark"}),o.attr({x:function(a,r){return-i[r]/2},y:function(a,r){return 2==r?-t/5:0},width:function(a,r){return i[r]},height:function(a,r){return e[r]},transform:function(a){return"rotate("+(r.axisConfig.originTheta-90+r.angularScale(a))+")"}}).style(n),l.selectAll("circle.mark").data([0]).enter().append("circle").attr({"class":"mark"}).attr({r:t/10}).style({"fill-opacity":1}).style(n)})}var r={data:null,containerSelector:"body",fill:"orange",stroke:"red",radialScale:null,angularScale:null,axisConfig:null},t=d3.dispatch("hover");return a.config=function(a){return arguments.length?(micropolar._override(a,r),this):r},d3.rebind(a,t,"on"),a},micropolar.AreaChart=function(){function a(){var a=r.containerSelector;"string"==typeof a&&(a=d3.select(a)),a.datum(r.data).each(function(a){var t=360/a.length*Math.PI/180/2,e={fill:r.fill,stroke:r.stroke},i=d3.select(this).classed("area-chart",!0),n=i.selectAll("path.mark").data(a);n.enter().append("path").attr({"class":"mark"}),n.attr({d:function(a){var e=r.radialScale(a[1]),i=Math.tan(t)*e;return"M"+[[0,0],[e,i],[e,-i]].join("L")+"Z"},transform:function(a,t){return"rotate("+(r.axisConfig.originTheta-90+r.angularScale(t))+")"}}).style(e)})}var r={data:null,containerSelector:"body",dotRadius:5,fill:"orange",stroke:"red",radialScale:null,angularScale:null,axisConfig:null},t=d3.dispatch("hover");return a.config=function(a){return arguments.length?(micropolar._override(a,r),this):r},d3.rebind(a,t,"on"),a},micropolar.DotPlot=function(){function a(){var a=r.containerSelector;"string"==typeof a&&(a=d3.select(a)),a.datum(r.data).each(function(a){var t={fill:r.fill,stroke:r.stroke},e=d3.select(this).classed("dot-plot",!0),i=e.selectAll("circle.mark").data(a);i.enter().append("circle").attr({"class":"mark"}),i.attr({cy:function(a){return r.radialScale(a[1])},r:r.dotRadius,transform:function(a){return"rotate("+(r.axisConfig.originTheta-90+r.angularScale(a[0]))+")"}}).style(t)})}var r={data:null,containerSelector:"body",dotRadius:3,fill:"orange",stroke:"red",radialScale:null,angularScale:null,axisConfig:null},t=d3.dispatch("hover");return a.config=function(a){return arguments.length?(micropolar._override(a,r),this):r},d3.rebind(a,t,"on"),a},micropolar.LinePlot=function(){function a(){var a=r.containerSelector;"string"==typeof a&&(a=d3.select(a)),a.datum(r.data).each(function(a){var t=d3.svg.line.radial().radius(function(a){return r.radialScale(a[1])}).angle(function(a){return r.angularScale(a[0])*Math.PI/180*(r.axisConfig.flip?1:-1)}),e={fill:"none","stroke-width":r.lineStrokeSize,stroke:r.stroke,"pointer-events":"stroke"},i=d3.select(this).classed("line-plot",!0),n=i.selectAll("path.mark").data([0]);n.enter().append("path").attr({"class":"mark"}),i.select("path.mark").datum(a).attr({d:t,transform:"rotate("+(r.axisConfig.originTheta+90)+")","stroke-width":r.lineStrokeSize+"px"}).style(e)})}var r={data:null,containerSelector:"body",lineStrokeSize:2,stroke:"orange",radialScale:null,angularScale:null,axisConfig:null},t=d3.dispatch("hover");return a.config=function(a){return arguments.length?(micropolar._override(a,r),this):r},d3.rebind(a,t,"on"),a},micropolar.StackedAreaChart=function(){function a(){var a=r.containerSelector;"string"==typeof a&&(a=d3.select(a)),a.datum(r.data).each(function(a){var t=d3.nest().key(function(a){return a[2]}).entries(a);t.forEach(function(a){a.values.forEach(function(a){a.x=a[0],a.y=+a[1]})});var e=d3.layout.stack().values(function(a){return a.values}),i=360/d3.keys(d3.nest().key(function(a){return a[0]}).map(a)).length*Math.PI/180/2,n={fill:function(a){return r.colorScale(a[2])},stroke:"gray"},l=d3.select(this).classed("stacked-area-chart",!0),o=l.selectAll("g.layer").data(e(t)).enter().append("g").classed("layer",!0).selectAll("path.mark").data(function(a){return a.values});o.enter().append("path").attr({"class":"mark"}),o.attr({d:function(a){var t=r.radialScale(a.y+a.y0),e=r.radialScale(a.y0),n=Math.tan(i)*t,l=Math.tan(i)*e;return"M"+[[e,l],[t,n],[t,-n],[e,-l]].join("L")+"Z"},transform:function(a,t){return"rotate("+(r.axisConfig.originTheta-90+r.angularScale(t))+")"}}).style(n)})}var r={data:null,containerSelector:"body",dotRadius:5,fill:"orange",stroke:"red",radialScale:null,angularScale:null,colorScale:d3.scale.category20(),axisConfig:null},t=d3.dispatch("hover");return a.config=function(a){return arguments.length?(micropolar._override(a,r),this):r},d3.rebind(a,t,"on"),a},micropolar.preset={},micropolar.preset.linePlot=function(a){a&&a.size&&(a.width=a.height=a.size);var r=micropolar.LinePlot(),t={geometry:r,data:d3.range(0,721,1).map(function(a,r){return[a,2*(r/720)]}),height:250,width:250,angularDomain:[0,360],additionalAngularEndTick:!1,angularTicksStep:30,angularTicksSuffix:"ยบ",minorTicks:1,flip:!1,originTheta:0,radialAxisTheta:-30,containerSelector:"body"};micropolar._override(a,t);var e=micropolar.Axis().config(t);e()},micropolar.preset.dotPlot=function(a){a&&a.size&&(a.width=a.height=a.size);var r=micropolar.DotPlot(),t=d3.scale.linear().domain([-3,3]).range([0,1]),e={geometry:r,data:d3.range(0,100).map(function(){return[~~(1e3*t(micropolar._rndSnd())),~~(100*t(micropolar._rndSnd()))]}),height:250,width:250,angularDomain:[0,1e3],additionalAngularEndTick:!1,angularTicksStep:100,minorTicks:1,flip:!1,originTheta:0,radialAxisTheta:-15,containerSelector:"body"};micropolar._override(a,e);var i=micropolar.Axis().config(e);i()},micropolar.preset.barChart=function(a){a&&a.size&&(a.width=a.height=a.size);var r=micropolar.BarChart(),t={geometry:r,data:d3.range(0,20).map(function(a,r){return[50*a,Math.ceil(5*Math.random()*(r+1))]}),height:250,width:250,radialDomain:[-60,100],angularDomain:[0,1e3],angularTicksStep:50,minorTicks:1,flip:!0,originTheta:0,radialAxisTheta:-10,containerSelector:"body"};micropolar._override(a,t);var e=micropolar.Axis().config(t);e()},micropolar.preset.areaChart=function(a){a&&a.size&&(a.width=a.height=a.size);var r=micropolar.AreaChart(),t={geometry:r,data:d3.range(0,12).map(function(a){return[50*a+50,~~(10*Math.random()+5)]}),height:250,width:250,radialDomain:[0,20],angularDomain:["North","East","South","West"],additionalAngularEndTick:!1,minorTicks:2,flip:!0,originTheta:-90,radialAxisTheta:-30,radialTicksSuffix:"%",containerSelector:"body"};micropolar._override(a,t);var e=micropolar.Axis().config(t);e()},micropolar.preset.clock=function(a){a&&a.size&&(a.width=a.height=a.size);var r=micropolar.Clock(),t={geometry:r,data:[12,4,8],height:250,width:250,angularDomain:[0,12],additionalAngularEndTick:!1,minorTicks:9,flip:!0,originTheta:-90,showRadialAxis:!1,showRadialCircle:!1,rewriteTicks:function(a){return"0"===a?"12":a},labelOffset:-15,tickLength:5,containerSelector:"body"};micropolar._override(a,t);var e=micropolar.Axis().config(t);e()};